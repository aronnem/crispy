{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[ 655.  665.  675.  685.  695.  705.  715.  725.]\n"
     ]
    }
   ],
   "source": [
    "import tools\n",
    "from tools.wavecal import computeWavecal\n",
    "import glob\n",
    "from params import Params\n",
    "import numpy as np\n",
    "import logging as log\n",
    "from tools.initLogger import initLogger\n",
    "from astropy.io import fits as pyf\n",
    "\n",
    "\n",
    "par = Params()\n",
    "initLogger(par.exportDir+'/IFSWavecalHighSNR.log')\n",
    "\n",
    "\n",
    "par=Params()\n",
    "\n",
    "filelist = np.sort(glob.glob(par.wavecalDir + \"*.fits\"))\n",
    "lamlist = range(655,726,10)\n",
    "lam = np.loadtxt(par.wavecalDir + \"lamsol.dat\")[:, 0]\n",
    "print lam\n",
    "filelist\n",
    "par.lamlist = lamlist\n",
    "par.filelist = filelist"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "tools/wavecal.py:68: FutureWarning: comparison to `None` will result in an elementwise object comparison in the future.\n",
      "  if (filelist!=None) and (lamlist!=None):\n",
      "2017-01-31 13:09:05,471: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_655nm_2017-01-13-15-01-42_sub.fits\n",
      "2017-01-31 13:09:05,472: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_655nm_2017-01-13-15-01-42_sub.fits\n",
      "2017-01-31 13:09:06,064: INFO     Initializing PSFlet location transformation coefficients\n",
      "2017-01-31 13:09:08,306: INFO     Performing initial optimization of PSFlet location transformation coefficients for frame /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_655nm_2017-01-13-15-01-42_sub.fits\n",
      "2017-01-31 13:09:15,715: INFO     Performing final optimization of PSFlet location transformation coefficients for frame /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_655nm_2017-01-13-15-01-42_sub.fits\n",
      "2017-01-31 13:10:05,012: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_665nm_2017-01-13-16-02-21_sub.fits\n",
      "2017-01-31 13:10:05,013: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_665nm_2017-01-13-16-02-21_sub.fits\n",
      "2017-01-31 13:10:05,657: INFO     Initializing transformation coefficients with previous values\n",
      "2017-01-31 13:10:16,367: INFO     Performing final optimization of PSFlet location transformation coefficients for frame /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_665nm_2017-01-13-16-02-21_sub.fits\n",
      "2017-01-31 13:10:47,198: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_675nm_2017-01-13-17-02-50_sub.fits\n",
      "2017-01-31 13:10:47,199: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_675nm_2017-01-13-17-02-50_sub.fits\n",
      "2017-01-31 13:10:47,871: INFO     Initializing transformation coefficients with previous values\n",
      "2017-01-31 13:10:57,992: INFO     Performing final optimization of PSFlet location transformation coefficients for frame /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_675nm_2017-01-13-17-02-50_sub.fits\n",
      "2017-01-31 13:11:13,468: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_685nm_2017-01-13-18-03-21_sub.fits\n",
      "2017-01-31 13:11:13,470: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_685nm_2017-01-13-18-03-21_sub.fits\n",
      "2017-01-31 13:11:14,100: INFO     Initializing transformation coefficients with previous values\n",
      "2017-01-31 13:11:24,774: INFO     Performing final optimization of PSFlet location transformation coefficients for frame /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_685nm_2017-01-13-18-03-21_sub.fits\n",
      "2017-01-31 13:11:34,963: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_695nm_2017-01-13-19-03-50_sub.fits\n",
      "2017-01-31 13:11:34,964: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_695nm_2017-01-13-19-03-50_sub.fits\n",
      "2017-01-31 13:11:35,608: INFO     Initializing transformation coefficients with previous values\n",
      "2017-01-31 13:11:46,417: INFO     Performing final optimization of PSFlet location transformation coefficients for frame /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_695nm_2017-01-13-19-03-50_sub.fits\n",
      "2017-01-31 13:11:55,162: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_705nm_2017-01-13-20-04-18_sub.fits\n",
      "2017-01-31 13:11:55,163: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_705nm_2017-01-13-20-04-18_sub.fits\n",
      "2017-01-31 13:11:55,832: INFO     Initializing transformation coefficients with previous values\n",
      "2017-01-31 13:12:06,214: INFO     Performing final optimization of PSFlet location transformation coefficients for frame /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_705nm_2017-01-13-20-04-18_sub.fits\n",
      "2017-01-31 13:12:20,355: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_715nm_2017-01-13-21-04-46_sub.fits\n",
      "2017-01-31 13:12:20,357: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_715nm_2017-01-13-21-04-46_sub.fits\n",
      "2017-01-31 13:12:20,959: INFO     Initializing transformation coefficients with previous values\n",
      "2017-01-31 13:12:31,208: INFO     Performing final optimization of PSFlet location transformation coefficients for frame /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_715nm_2017-01-13-21-04-46_sub.fits\n",
      "2017-01-31 13:12:41,611: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_725nm_2017-01-13-22-05-15_sub.fits\n",
      "2017-01-31 13:12:41,613: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_725nm_2017-01-13-22-05-15_sub.fits\n",
      "2017-01-31 13:12:42,229: INFO     Initializing transformation coefficients with previous values\n",
      "2017-01-31 13:12:52,451: INFO     Performing final optimization of PSFlet location transformation coefficients for frame /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_725nm_2017-01-13-22-05-15_sub.fits\n",
      "2017-01-31 13:13:01,648: INFO     Saving wavelength solution to /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lamsol.dat\n"
     ]
    }
   ],
   "source": [
    "computeWavecal(par,lamlist,filelist)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "collapsed": false,
    "scrolled": false
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2017-01-31 14:42:02,606: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_655nm_2017-01-13-15-01-42_sub.fits\n",
      "2017-01-31 14:42:02,608: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_655nm_2017-01-13-15-01-42_sub.fits\n",
      "2017-01-31 14:42:02,627: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_665nm_2017-01-13-16-02-21_sub.fits\n",
      "2017-01-31 14:42:02,628: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_665nm_2017-01-13-16-02-21_sub.fits\n",
      "2017-01-31 14:42:02,651: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_675nm_2017-01-13-17-02-50_sub.fits\n",
      "2017-01-31 14:42:02,652: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_675nm_2017-01-13-17-02-50_sub.fits\n",
      "2017-01-31 14:42:02,675: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_685nm_2017-01-13-18-03-21_sub.fits\n",
      "2017-01-31 14:42:02,676: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_685nm_2017-01-13-18-03-21_sub.fits\n",
      "2017-01-31 14:42:02,703: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_695nm_2017-01-13-19-03-50_sub.fits\n",
      "2017-01-31 14:42:02,704: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_695nm_2017-01-13-19-03-50_sub.fits\n",
      "2017-01-31 14:42:02,731: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_705nm_2017-01-13-20-04-18_sub.fits\n",
      "2017-01-31 14:42:02,732: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_705nm_2017-01-13-20-04-18_sub.fits\n",
      "2017-01-31 14:42:02,763: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_715nm_2017-01-13-21-04-46_sub.fits\n",
      "2017-01-31 14:42:02,764: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_715nm_2017-01-13-21-04-46_sub.fits\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[ 655.  665.  675.  685.  695.  705.  715.  725.] (8,)\n",
      "8\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2017-01-31 14:42:02,800: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_725nm_2017-01-13-22-05-15_sub.fits\n",
      "2017-01-31 14:42:02,801: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_725nm_2017-01-13-22-05-15_sub.fits\n",
      "tools/wavecal.py:232: VisibleDeprecationWarning: using a non-integer number instead of an integer will result in an error in the future\n",
      "  subim[k, iy::upsample, ix::upsample] = cutout\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Shape: (1032, 1056)\n",
      "Shape: (1032, 1056)\n",
      "Shape: (1032, 1056)\n",
      "Shape: (1032, 1056)\n",
      "Shape: (1032, 1056)\n",
      "Shape: (1032, 1056)\n",
      "Shape: (1032, 1056)\n",
      "Shape: (1032, 1056)\n"
     ]
    }
   ],
   "source": [
    "import tools\n",
    "from tools.wavecal import computeWavecal\n",
    "import glob\n",
    "from params import Params\n",
    "import numpy as np\n",
    "import logging as log\n",
    "from tools.initLogger import initLogger\n",
    "from astropy.io import fits as pyf\n",
    "from tools.image import Image\n",
    "\n",
    "\n",
    "par = Params()\n",
    "initLogger(par.exportDir+'/IFSWavecalHighSNR.log')\n",
    "from tools.locate_psflets import PSFLets\n",
    "from tools.wavecal import gethires\n",
    "lam = np.loadtxt(par.wavecalDir + \"lamsol.dat\")[:, 0]\n",
    "allcoef = np.loadtxt(par.wavecalDir + \"lamsol.dat\")[:, 1:]\n",
    "\n",
    "par.lamlist = [655, 665, 675, 685, 695, 705, 715, 725]\n",
    "par.filelist = np.sort(glob.glob(par.wavecalDir + \"*nm*.fits\"))\n",
    "print lam,lam.shape\n",
    "imlist = []\n",
    "print len(par.filelist)\n",
    "for j in range(len(par.lamlist)):\n",
    "    im = Image(filename=par.filelist[j])\n",
    "    imlist += [im]\n",
    "psftool = PSFLets()\n",
    "psftool.geninterparray(lam, allcoef)\n",
    "\n",
    "#psftool.genpixsol(lam, allcoef, lam1=lam1/1.04, lam2=lam2*1.03)\n",
    "#psftool.savepixsol(outdir=outdir)\n",
    "savehiresimages = True\n",
    "hires_arrs = []\n",
    "xindx = np.arange(-100, 101)\n",
    "xindx, yindx = np.meshgrid(xindx, xindx)\n",
    "for i in range(len(lam)):\n",
    "    xpos, ypos = psftool.return_locations(lam[i], allcoef, xindx, yindx)\n",
    "    xpos = np.reshape(xpos, -1)\n",
    "    ypos = np.reshape(ypos, -1)\n",
    "    print \"Shape:\",imlist[i].data.shape\n",
    "    hiresarr = gethires(xpos, ypos, imlist[i],upsample=3,nsubarr=3)\n",
    "    hires_arrs += [hiresarr]\n",
    "\n",
    "    if savehiresimages:\n",
    "        di, dj = hiresarr.shape[0], hiresarr.shape[2]\n",
    "        outim = np.zeros((di*dj, di*dj))\n",
    "        for ii in range(di):\n",
    "            for jj in range(di):\n",
    "                outim[ii*dj:(ii + 1)*dj, jj*dj:(jj + 1)*dj] = hiresarr[ii, jj]\n",
    "        out = pyf.HDUList(pyf.PrimaryHDU(hiresarr.astype(np.float32)))\n",
    "        out.writeto(par.wavecalDir + 'hires_psflets_lam%d.fits' % (lam[i]), clobber=True)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "WARNING: Unexpected extra padding at the end of the file.  This padding may not be preserved when saving changes. [astropy.io.fits.header]\n",
      "2017-01-24 11:11:00,360: WARNING  Unexpected extra padding at the end of the file.  This padding may not be preserved when saving changes.\n",
      "tools/reduction.py:223: RuntimeWarning: invalid value encountered in less\n",
      "  ycenter[~((xcenter<xdim)*(ycenter<ydim)*(xcenter>0)*(ycenter>2))] = np.nan\n",
      "tools/reduction.py:223: RuntimeWarning: invalid value encountered in greater\n",
      "  ycenter[~((xcenter<xdim)*(ycenter<ydim)*(xcenter>0)*(ycenter>2))] = np.nan\n",
      "2017-01-24 11:11:00,424: INFO     Wavelength = 655.0\n",
      "WARNING: 'exact' method is not implemented for rectangular apertures -- instead using 'subpixel' method with subpixels=32 [photutils.aperture.rectangle]\n",
      "2017-01-24 11:11:00,522: WARNING  'exact' method is not implemented for rectangular apertures -- instead using 'subpixel' method with subpixels=32\n",
      "2017-01-24 11:11:11,115: INFO     Wavelength = 660.0\n",
      "2017-01-24 11:11:21,776: INFO     Wavelength = 665.0\n",
      "2017-01-24 11:11:32,550: INFO     Wavelength = 670.0\n",
      "2017-01-24 11:11:43,089: INFO     Wavelength = 675.0\n",
      "2017-01-24 11:11:53,681: INFO     Wavelength = 680.0\n",
      "2017-01-24 11:12:04,327: INFO     Wavelength = 685.0\n",
      "2017-01-24 11:12:14,896: INFO     Wavelength = 690.0\n",
      "2017-01-24 11:12:25,631: INFO     Wavelength = 695.0\n",
      "2017-01-24 11:12:36,336: INFO     Wavelength = 700.0\n",
      "2017-01-24 11:12:46,914: INFO     Wavelength = 705.0\n",
      "2017-01-24 11:12:57,486: INFO     Wavelength = 710.0\n",
      "2017-01-24 11:13:08,153: INFO     Wavelength = 715.0\n",
      "2017-01-24 11:13:18,839: INFO     Wavelength = 720.0\n"
     ]
    }
   ],
   "source": [
    "from IFS import reduceIFSMap\n",
    "fname = '/Users/mrizzo/IFS/IFS-Simulator/Inputs/data161214_680nm_run501it1724_2.FIT'\n",
    "reduceIFSMap(par,fname,method='test')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "26\n",
      "[ 605.          609.39471004  613.82134317  618.2801313   622.77130799\n",
      "  627.29510852  631.85176985  636.4415307   641.0646315   645.72131443\n",
      "  650.41182342  655.13640419  659.89530425  664.68877287  669.51706117\n",
      "  674.38042207  679.27911035  684.21338262  689.18349737  694.18971494\n",
      "  699.2322976   704.31150949  709.4276167   714.58088722  719.77159102\n",
      "  725.        ]\n",
      "[ 607.19337906  611.60402176  616.04670331  620.52165641  625.0291155\n",
      "  629.56931671  634.14249785  638.74889851  643.38875999  648.06232535\n",
      "  652.76983941  657.51154877  662.28770183  667.09854879  671.94434166\n",
      "  676.8253343   681.74178238  686.69394346  691.68207695  696.70644417\n",
      "  701.7673083   706.86493447  711.99958972  717.17154301  722.38106529]\n"
     ]
    }
   ],
   "source": [
    "R=140\n",
    "lam1=605.\n",
    "lam2=725\n",
    "Nspec = int(np.log(lam2/lam1)*R + 1.5)\n",
    "print Nspec\n",
    "loglam_endpts = np.linspace(np.log(lam1), np.log(lam2), Nspec)\n",
    "loglam_midpts = (loglam_endpts[1:] + loglam_endpts[:-1])/2\n",
    "lam_endpts = np.exp(loglam_endpts)\n",
    "lam_midpts = np.exp(loglam_midpts)\n",
    "print lam_endpts\n",
    "print lam_midpts"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "14"
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "int(26./(1.5/0.43/2.))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "collapsed": false,
    "scrolled": false
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2017-01-31 17:34:45,690: INFO     Building calibration files, placing results in /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/\n",
      "2017-01-31 17:34:45,715: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_665nm_2017-01-13-16-02-21_sub.fits\n",
      "2017-01-31 17:34:45,716: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_665nm_2017-01-13-16-02-21_sub.fits\n",
      "2017-01-31 17:34:45,731: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_665nm_2017-01-13-16-02-21_sub.fits\n",
      "2017-01-31 17:34:45,732: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_665nm_2017-01-13-16-02-21_sub.fits\n",
      "2017-01-31 17:34:45,750: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_675nm_2017-01-13-17-02-50_sub.fits\n",
      "2017-01-31 17:34:45,751: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_675nm_2017-01-13-17-02-50_sub.fits\n",
      "2017-01-31 17:34:45,782: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_685nm_2017-01-13-18-03-21_sub.fits\n",
      "2017-01-31 17:34:45,783: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_685nm_2017-01-13-18-03-21_sub.fits\n",
      "2017-01-31 17:34:45,810: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_695nm_2017-01-13-19-03-50_sub.fits\n",
      "2017-01-31 17:34:45,811: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_695nm_2017-01-13-19-03-50_sub.fits\n",
      "2017-01-31 17:34:45,837: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_705nm_2017-01-13-20-04-18_sub.fits\n",
      "2017-01-31 17:34:45,838: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_705nm_2017-01-13-20-04-18_sub.fits\n",
      "2017-01-31 17:34:45,864: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_715nm_2017-01-13-21-04-46_sub.fits\n",
      "2017-01-31 17:34:45,865: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_715nm_2017-01-13-21-04-46_sub.fits\n",
      "2017-01-31 17:34:45,894: INFO     Read data from HDU 1 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_725nm_2017-01-13-22-05-15_sub.fits\n",
      "2017-01-31 17:34:45,895: INFO     Read inverse variance from HDU 2 of /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lltf_725nm_2017-01-13-22-05-15_sub.fits\n",
      "2017-01-31 17:34:45,895: INFO     Loading wavelength solution from /Users/mrizzo/IFS/IFS-Simulator/ReferenceFiles/HighSNRWavecal/lamsol.dat\n",
      "2017-01-31 17:34:45,897: INFO     Computing wavelength values at pixel centers\n",
      "2017-01-31 17:34:48,263: INFO     Making high-resolution PSFLet models\n",
      "tools/wavecal.py:369: VisibleDeprecationWarning: using a non-integer number instead of an integer will result in an error in the future\n",
      "  subim[k, iy::upsample, ix::upsample] = cutout\n",
      "tools/wavecal.py:369: VisibleDeprecationWarning: using a non-integer number instead of an integer will result in an error in the future\n",
      "  subim[k, iy::upsample, ix::upsample] = cutout\n",
      "tools/wavecal.py:369: VisibleDeprecationWarning: using a non-integer number instead of an integer will result in an error in the future\n",
      "  subim[k, iy::upsample, ix::upsample] = cutout\n",
      "tools/wavecal.py:369: VisibleDeprecationWarning: using a non-integer number instead of an integer will result in an error in the future\n",
      "  subim[k, iy::upsample, ix::upsample] = cutout\n",
      "tools/wavecal.py:369: VisibleDeprecationWarning: using a non-integer number instead of an integer will result in an error in the future\n",
      "  subim[k, iy::upsample, ix::upsample] = cutout\n",
      "tools/wavecal.py:369: VisibleDeprecationWarning: using a non-integer number instead of an integer will result in an error in the future\n",
      "  subim[k, iy::upsample, ix::upsample] = cutout\n",
      "tools/wavecal.py:369: VisibleDeprecationWarning: using a non-integer number instead of an integer will result in an error in the future\n",
      "  subim[k, iy::upsample, ix::upsample] = cutout\n",
      "2017-01-31 17:34:58,400: INFO     Reduced cube will have 23 wavelength bins\n",
      "2017-01-31 17:34:58,404: INFO     Making polychrome cube\n",
      "2017-01-31 20:57:07,778: INFO     Saving polychrome cube\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Total time elapsed: 12144\n"
     ]
    }
   ],
   "source": [
    "import tools\n",
    "from tools.wavecal import computeWavecal\n",
    "import glob\n",
    "from params import Params\n",
    "import numpy as np\n",
    "import logging as log\n",
    "from tools.initLogger import initLogger\n",
    "from astropy.io import fits as pyf\n",
    "from tools.image import Image\n",
    "\n",
    "\n",
    "par = Params()\n",
    "initLogger(par.exportDir+'/IFSWavecalHighSNR.log')\n",
    "\n",
    "par.lamlist = [665, 675, 685, 695, 705, 715, 725]\n",
    "par.filelist = np.sort(glob.glob(par.wavecalDir + \"*nm*.fits\"))\n",
    "\n",
    "from tools.wavecal import buildcalibrations\n",
    "buildcalibrations(par,genwavelengthsol=False,parallel=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "10000000000.0"
      ]
     },
     "execution_count": 2,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "10**(0.4*25)"
   ]
  }
 ],
 "metadata": {
  "anaconda-cloud": {},
  "kernelspec": {
   "display_name": "Python [conda env:py27]",
   "language": "python",
   "name": "conda-env-py27-py"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 2
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython2",
   "version": "2.7.12"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 1
}
